{% extends 'base.html.twig' %}

{% block title %}Hello DestinationDetailsController!
{% endblock %}

{% block body %}

	<div class="destination_banner_wrap overlay" style="background-image:url({{asset('/img/place/'~ ville.image)}});">
		<div class="destination_text text-center">
			<h3>{{ville.name}}</h3>
		</div>
	</div>
	<!-- start description-->
	<div class="destination_details_info">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-8 col-md-9">
					<div class="destination_info">
						<h3>Description</h3>
						<p>Ouarzazate est une ville au sud des montagnes du Haut Atlas marocain,
																																																																																																									connue comme étant la porte du désert du Sahara. Son énorme Kasbah de Taourirt, abritant un
																																																																																																									palais du XIXe siècle,
																																																																																																									offre une vue sur le paysage rocailleux des environs, qui apparaît dans plusieurs films.
						</p>
						<p>
							Au nord-ouest se trouve la ville fortifiée en terre rouge d'Aït-ben-Haddou, tandis que les
																																																																																																									gorges rocailleuses du Toudra s'étendent au nord-est.
																																																																																																									Une route serpente vers le sud-est, à travers les palmeraies luxuriantes de la vallée du
																																																																																																									Drâa, en direction du désert.</p>
						<p></p>
						<div class="single_destination">
							<h4>Kasbah de Taourirt</h4>
							<p>La Kasbah de Taourirt et son ancienne médina se situent dans le centre-ville de
																																																																																																																								Ouarzazate. Une kasbah est l’équivalent de nos châteaux forts du Moyen-Âge,
																																																																																																																								soit une maison fortifiée dans laquelle habitait le seigneur local (le pacha) et sa
																																																																																																																								famille. Construite au XVIIe siècle en pisé (un mélange de terre et de paille séchées au
																																																																																																																								soleil),
																																																																																																																								cette belle demeure restaurée donne une idée de l’opulence du seigneur d’alors, un haut
																																																																																																																								dignitaire de la royauté marocaine</p>
						</div>
					</div>
					<div class="bordered_1px"></div>
				</div>
			</div>
		</div>
	</div>
	<!-- end description-->

	<div class="row justify-content-center">
		<div class="col-lg-6">
			<div class="section_title text-center mb_70">
				<h3>La carte</h3>
			</div>
		</div>
	</div>


	<!-- start map-->
	<div class="container">
		<div class="d-none d-sm-block mb-5 pb-4">
			<div id="map" style="height: 480px; width: 770px; position: relative;"></div>


			<div class="col-lg-4" style=" left: 790px; top: -480px;">
				<div class="filter_result_wrap">
					<h3>Filter de résultats</h3>
					<div class="filter_bordered">
						<div class="filter_inner">
							<div class="row">
								<form class="was-validated">
									{% if hotelMarkers is not empty %}
										<div class="custom-control form-check-inline custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation1" value="hotels" required checked>
											<label class="custom-control-label" for="customControlValidation1">Hotels</label>
											<img src='{{asset("img/marker_icon/hotel_30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% else %}
										<div class="custom-control form-check-inline custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation1" value="hotels" required disabled>
											<label class="custom-control-label" for="customControlValidation1">Hotels</label>
											<img src='{{asset("img/marker_icon/hotel_30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% endif %}

									{% if restoMarkers is not empty %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation2" value="restos" required checked>
											<label class="custom-control-label" for="customControlValidation2">Restorants</label>
											<img src='{{asset("img/marker_icon/resto_30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% else %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation2" value="restos" required disabled>
											<label class="custom-control-label" for="customControlValidation2">Restorants</label>
											<img src='{{asset("img/marker_icon/resto_30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% endif %}

									{% if activiteMarkers is not empty %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation3" value="restos" required checked>
											<label class="custom-control-label" for="customControlValidation3">Activités</label>
											<img src='{{asset("img/marker_icon/activite30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% else %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation3" value="restos" required disabled>
											<label class="custom-control-label" for="customControlValidation3">Activités</label>
											<img src='{{asset("img/marker_icon/activite30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% endif %}

									{% if campingMarkers is not empty %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation4" value="restos" required checked>
											<label class="custom-control-label" for="customControlValidation4">Campings</label>
											<img src='{{asset("img/marker_icon/tent30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% else %}
										<div class="custom-control custom-checkbox mb-3">
											<input type="checkbox" class="custom-control-input" id="customControlValidation4" value="restos" required disabled>
											<label class="custom-control-label" for="customControlValidation4">Campings</label>
											<img src='{{asset("img/marker_icon/tent30.png")}}' alt="">
											<div class="invalid-feedback">Not checked</div>
										</div>
									{% endif %}
								</form>
								{# <div class="col-lg-12">
																																																																																							                                        
						</div>
						<div class="col-lg-12">
																																																																																																																										
						</div>
						<div class="col-lg-12">
																																																																																																																										
						</div> #}
							</div>
						</div>
					</div>
				</div>
			</div>
			<script language="JavaScript" type="text/javascript" src="/js/vendor/jquery-1.12.4.min.js"></script>


			<script>
				var hotelMarkers = [];
var campingMarkers = [];
var restoMarkers = [];
var activiteMarkers = [];
			</script>
			{% for hotelMarker in hotelMarkers %}
				<script>
					var hotelMarker = {
position: {
lat: {{ hotelMarker.lat }},
lng: {{ hotelMarker.lng }}
},
title: "{{ hotelMarker.name | replace({' ': '_'}) }}"
};
hotelMarkers.push(hotelMarker);
				</script>
				{% endfor%}

				{% for campingMarker in campingMarkers %}
					<script>
						var campingMarker = {
position: {
lat: {{ campingMarker.lat }},
lng: {{ campingMarker.lng }}
},
title: "{{ campingMarker.name | replace({' ': '_'}) }}"
};
campingMarkers.push(campingMarker);
					</script>
					{% endfor%}

					{% for activiteMarker in activiteMarkers %}
						<script>
							var activiteMarker = {
position: {
lat: {{ activiteMarker.lat }},
lng: {{ activiteMarker.lng }}
},
title: "{{ activiteMarker.name | replace({' ': '_'}) }}"
};
activiteMarkers.push(activiteMarker);
						</script>
						{% endfor%}

{% for restoMarker in restoMarkers %}
<script>
var restoMarker = {
position: {
lat: {{ restoMarker.lat }},
lng: {{ restoMarker.lng }}
},
title: "{{ restoMarker.name | replace({' ': '_'})}}"
};
restoMarkers.push(restoMarker);
								</script>
								{% endfor%}

								<script>
									function initMap() {
var uluru = {
lat: {{ villeMarker.lat }},
lng: {{ villeMarker.lng }}
};

var map = new google.maps.Map(document.getElementById('map'), {
zoom: 13,
center: uluru,
scrollwheel: true, /*mapTypeId: 'satellite'*/
mapTypeId: google.maps.MapTypeId.ROADMAP
});
var marker = new google.maps.Marker({
position: uluru, map: map, clickable: true, animation: google.maps.Animation.BOUNCE /*DROP*/
});
marker.setTitle("cmnt");
marker.addListener('click', function () {
$('html,body').animate({
scrollTop: $("#" + marker.getTitle()).offset().top
}, 'slow');
});

var markers = [];

for (let i = 0; i < hotelMarkers.length; i++) {
var mh = new google.maps.Marker({
position: hotelMarkers[i].position, map: map,
// label: "H",
icon: {
url: '{{ asset("img/marker_icon/hotel_50.png") }}'
}
});
mh.setTitle(hotelMarkers[i].title);

markers.push(mh);
}

for (let i = 0; i < restoMarkers.length; i++) {
var mr = new google.maps.Marker({
position: restoMarkers[i].position, map: map,
// label: "R"
icon: '{{ asset("img/marker_icon/resto_50.png") }}'
});
mr.setTitle(restoMarkers[i].title);

markers.push(mr);
}

for (let i = 0; i < campingMarkers.length; i++) {
var mc = new google.maps.Marker({position: campingMarkers[i].position, map: map, icon: '{{ asset("img/marker_icon/tent50.png") }}'});
mc.setTitle(campingMarkers[i].title);

markers.push(mc);
}

for (let i = 0; i < activiteMarkers.length; i++) {
var ma = new google.maps.Marker({position: activiteMarkers[i].position, map: map, icon: '{{ asset("img/marker_icon/activite50.png") }}'});
ma.setTitle(activiteMarkers[i].title);

markers.push(ma);
}

var infowindow = new google.maps.InfoWindow();
markers.map((m) => {
m.addListener('click', function () {
$('html,body').animate({
scrollTop: $("#" + m.getTitle()).offset().top
}, 'slow');
$("#" + m.getTitle()).hide(1100);
$("#" + m.getTitle()).show(2000);
// $("#" + m.getTitle()).animate({height: '+=20%'});


});

m.addListener('mouseover', function () {
infowindow.setContent(m.getTitle());
infowindow.open(map, m);
});
});

$("#customControlValidation1").change(function () {

if (this.checked) {
markers.map((m) => {
for (let i = 0; i < hotelMarkers.length; i++) {
if (m.getTitle() == hotelMarkers[i].title) {
m.setVisible(true);
}
}
});
} else {
markers.map((m) => {
for (let i = 0; i < hotelMarkers.length; i++) {
if (m.getTitle() == hotelMarkers[i].title) {
m.setVisible(false);
}
}
});
}
});

$("#customControlValidation3").change(function () {

if (this.checked) {
markers.map((m) => {
for (let i = 0; i < activiteMarkers.length; i++) {
if (m.getTitle() == activiteMarkers[i].title) {
m.setVisible(true);
}
}
});
} else {
markers.map((m) => {
for (let i = 0; i < activiteMarkers.length; i++) {
if (m.getTitle() == activiteMarkers[i].title) {
m.setVisible(false);
}
}
});
}
});

$("#customControlValidation2").change(function () {

if (this.checked) {
markers.map((m) => {
for (let i = 0; i < restoMarkers.length; i++) {
if (m.getTitle() == restoMarkers[i].title) {
m.setVisible(true);
}
}
});
} else {
markers.map((m) => {
for (let i = 0; i < restoMarkers.length; i++) {
if (m.getTitle() == restoMarkers[i].title) {
m.setVisible(false);
}
}
});
}
});

$("#customControlValidation4").change(function () {
if (this.checked) {
markers.map((m) => {
for (let i = 0; i < campingMarkers.length; i++) {
if (m.getTitle() == campingMarkers[i].title) {
m.setVisible(true);
}
}
});
} else {
markers.map((m) => {
for (let i = 0; i < campingMarkers.length; i++) {
if (m.getTitle() == campingMarkers[i].title) {
m.setVisible(false);
}
}
});
}
});

}
								</script>

								<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmC9pqdr3_Wbb9jGSl9EBKNNNAhcA6puE&callback=initMap"></script>

							</div>
						</div>
						
					<!-- end description-->
						{% if hotels is not empty  and hotelMarkers is not empty %}
							<!-- start hotels-->
							<div class="popular_places_area">
								<div class="container">
									<div class="row justify-content-center">
										<div class="col-lg-6">
											<div class="section_title text-center mb_70">
												<h3>Hotels</h3>
											</div>
										</div>
									</div>
									<div class="row">
										{% for marker in hotelMarkers %}
											{% for hotel in  hotels%}
												{% if marker.name | replace({' ': '_'}) == hotel.nom | replace({' ': '_'}) %}
													<div id={{marker.name | replace({' ': '_'})}} class="col-lg-4 col-md-6">
														<div class="single_place">
															<div class="thumb">
																<img src="{{asset('/img/hotel/' ~ hotel.imgPath)}}" alt={{hotel.nom}}>
															</div>
															<div class="place_info">
																<a href="destination_details.html">
																	<h3>{{marker.name}}</h3>
																</a>
																<div class="rating_days d-flex justify-content-between">
																	<span class="d-flex justify-content-center align-items-center">
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<a href="#">(20 Review)</a>
																	</span>

																</div>
															</div>
														</div>
													</div>
												{% endif %}
											{% endfor %}
										{% endfor %}
										</div>
									</div>
								</div>
						{% endif %}
					<!-- end hotels-->

					<!-- start Restaurants-->
						{% if restos is not empty %}
							<div class="popular_places_area">
								<div class="container">
									<div class="row justify-content-center">
										<div class="col-lg-6">
											<div class="section_title text-center mb_70">
												<h3>Restaurants</h3>
											</div>
										</div>
									</div>
									<div class="row">
										{% for marker in restoMarkers %}
											{% for resto in  restos%}
												{% if marker.name | replace({' ': '_'}) == resto.nom | replace({' ': '_'}) %}
													<div id={{marker.name| replace({' ': '_'})}} class="col-lg-4 col-md-6">
														<div class="single_place">
															<div class="thumb">
																<img style="width: 400px; height: 425px;" src="{{asset('/img/resto/' ~ resto.imgPath)}}" alt="resto.nom">
															</div>
															<div class="place_info">
																<a href="destination_details.html">
																	<h3>{{marker.name}}</h3>
																</a>
																<div class="rating_days d-flex justify-content-between">
																	<span class="d-flex justify-content-center align-items-center">
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<a href="#">(20 Review)</a>
																	</span>
																</div>
															</div>
														</div>
													</div>
												{% endif %}
											{% endfor %}
										{% endfor %}
										</div>
									</div>
								</div>
						{% endif %}
					<!-- end Restaurants-->

					<!-- start activite-->
						{% if activites is not empty %}	
							<div class="popular_places_area">
								<div class="container">
									<div class="row justify-content-center">
										<div class="col-lg-6">
											<div class="section_title text-center mb_70">
												<h3>Activités</h3>
											</div>
										</div>
									</div>
									<div class="row">
										{% for marker in activiteMarkers %}
											{% for activite in  activites %}
												{% if marker.name | replace({' ': '_'}) == activite.nom | replace({' ': '_'}) %}
													<div id={{marker.name| replace({' ': '_'})}} class="col-lg-4 col-md-6">
														<div class="single_place">
															<div class="thumb">
																<img style="width: 400px; height: 425px;" src="{{asset('/img/activite/' ~ activite.imgPath)}}" alt="activite.nom">
															</div>
															<div class="place_info">
																<a href="destination_details.html">
																	<h3>{{marker.name}}</h3>
																</a>
																<div class="rating_days d-flex justify-content-between">
																	<span class="d-flex justify-content-center align-items-center">
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<a href="#">(20 Review)</a>
																	</span>
																</div>
															</div>
														</div>
													</div>
												{% endif %}
											{% endfor %}
										{% endfor %}
										</div>
									</div>
								</div>
								
						{% endif %}
					<!-- end Restaurants-->

					<!-- start campings-->
						{% if campings is not empty %}
							<div class="popular_places_area">
								<div class="container">
									<div class="row justify-content-center">
										<div class="col-lg-6">
											<div class="section_title text-center mb_70">
												<h3>Campings</h3>
											</div>
										</div>
									</div>
									<div class="row">
										{% for marker in campingMarkers %}
											{% for camping in  campings %}
												{% if marker.name | replace({' ': '_'}) == camping.nom | replace({' ': '_'}) %}
													<div id={{marker.name| replace({' ': '_'})}} class="col-lg-4 col-md-6">
														<div class="single_place">
															<div class="thumb">
																<img style="width: 400px; height: 425px;" src="{{asset('/img/camping/' ~ camping.imgPath)}}" alt="camping.nom">
															</div>
															<div class="place_info">
																<a href="destination_details.html">
																	<h3>{{marker.name}}</h3>
																</a>
																<div class="rating_days d-flex justify-content-between">
																	<span class="d-flex justify-content-center align-items-center">
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<i class="fa fa-star"></i>
																		<a href="#">(20 Review)</a>
																	</span>
																</div>
															{% endif %}
														{% endfor %}
													{% endfor %}
												</div>
											</div>
										</div>
										<!-- end campoings-->
									{% endif %}
									<!-- start comntaire-->
									{% if  comentaires  is not empty %}
										<div id="cmnt" class="destination_details_info">
											<div class="container">
												<div class="section_title text-center mb_70">
													<h3>Comentaires</h3>
												</div>
												<div class="row justify-content-center">
													<div class="col-lg-8 col-md-9 col-lg-12 ">
														<div class="destination_info" id="comentaires">
															{% for comentaire in comentaires %}
																<h4>{{comentaire.user.nom }}
																	{{comentaire.user.prenom }}</h4>
																<p>{{comentaire.comentaire}}</p>
																<div id="border" class="bordered_1px"></div>
															{% endfor %}
														</div>
													</div>
													<div id="Ali" class="bordered_1px"></div>
													<form class="AjaxForm" action="{{path('comentaire')}}" method="post" >
														<div class="col-lg-12">
															<div class="single_input">
																<textarea name="comentaire" id="comentaire" cols="30" rows="10" placeholder="comentaire"></textarea>
															</div>
														</div>
														<div class="col-lg-12">
                                                              <input name="ville" id="ville" type="hidden" value="{{ville.id}}" >
														</div>
														<div class="col-lg-12">
															<div class="submit_btn">
																{%  if app.user %}
																	<button class="boxed-btn4" type="submit">Envoyer</button>
																{% else %}
																      {{ app.session.set('ville',ville.name)}}
																	<h3>
																		Pour faire un commentaire, <br> vous devez être connecté ,
																		<a style="color=red;" href="{{path('comentaire')}}">
																		ici
																	     </a>
																	</h3>

																{% endif %} 

															</div>
														</div>
													</form>
												</div>
											</div>
										</div>
										{% endif %}
										<!-- end comntaire-->

	{% endblock %}
	{% block javascripts %}
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	   <script>
      (function (){
		  
        	 document.querySelector('.AjaxForm').addEventListener('submit', function(e) {
               e.preventDefault();
	     	axios.post($(".AjaxForm").attr('action'),{
                     comentaire:$('#comentaire').val(),
					 ville:$('#ville').val()
               })
                .then(function (response) {
                       console.log(response);
                        const $error=response.data.error;
						if($error=="empty"){
                          $('#comentaires').append('<div id="error"class="alert alert-danger" role="alert"><strong>le comentaire est vide!!</strong>');
						}else{
                        const comentaire=response.data.comentaire;
  				        const nom=response.data.nom;
						const prenom=response.data.prenom;
						$('#comentaires').append("<h4>"+nom+" "+prenom+"</h4>");
						$('#comentaires').append("<p>"+comentaire+"</h>");
						$('#comentaires').append('<div id="border" class="bordered_1px"></div>');
				        $('#error').hide();
						}
						
				})
				.catch(function (error) {
						console.log(error);
				});
								
            	 });
		})();

     
		</script>
		
	{% endblock %}
